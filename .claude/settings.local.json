{
  "permissions": {
    "allow": [
      "mcp__Desktop_Commander__list_directory",
      "mcp__Desktop_Commander__read_file",
      "Bash(powershell -Command:*)",
      "Bash(powershell:*)",
      "mcp__Desktop_Commander__start_search",
      "Bash(git init:*)",
      "Bash(echo:*)",
      "Bash(python -m venv:*)",
      "Bash(./venv/Scripts/pip install:*)",
      "Bash(./venv/Scripts/python.exe -m pip install:*)",
      "Bash(config/config.yaml << 'EOF'\napp:\n  name: \"Image Fetcher Bot\"\n  version: \"1.0.0\"\n  batch_size: 50\n\nscheduler:\n  enabled: true\n  timezone: \"UTC\"\n  interval:\n    hours: 6\n  missed_execution_grace_time: 3600\n\nimage_search:\n  sources:\n    unsplash: 1\n    pexels: 2\n    pixabay: 3\n    web_scraper: 4\n  \n  unsplash:\n    results_per_query: 5\n    orientation: \"landscape\"\n    \n  pexels:\n    results_per_query: 5\n    size: \"medium\"\n    \n  pixabay:\n    results_per_query: 5\n    image_type: \"photo\"\n    \n  minimum_relevance_score: 0.6\n  \n  validation:\n    min_width: 800\n    min_height: 600\n    max_file_size_mb: 5\n    allowed_formats: [\"JPEG\", \"PNG\", \"WebP\"]\n    min_aspect_ratio: 0.5\n    max_aspect_ratio: 2.0\n\nkeywords:\n  min_length: 3\n  max_keywords: 5\n  remove_numbers: false\n  expand_abbreviations: true\n\nrate_limits:\n  unsplash: 50\n  pexels: 200\n  pixabay: 100\n  replit: 100\n\nretry:\n  max_attempts: 3\n  base_delay: 2\n  max_delay: 60\n  exponential_base: 2\n\nstate:\n  retention_days: 30\n  failed_retry_limit: 3\n\nlogging:\n  level: \"INFO\"\n  format: \"json\"\n  file:\n    enabled: true\n    path: \"./logs/app.log\"\n    max_bytes: 10485760\n    backup_count: 5\n  console:\n    enabled: true\nEOF)",
      "Bash(config/logging.yaml << 'EOF'\nversion: 1\ndisable_existing_loggers: false\n\nformatters:\n  json:\n    class: pythonjsonlogger.jsonlogger.JsonFormatter\n    format: \"%\\(asctime\\)s %\\(name\\)s %\\(levelname\\)s %\\(message\\)s\"\n  \n  standard:\n    format: \"%\\(asctime\\)s - %\\(name\\)s - %\\(levelname\\)s - %\\(message\\)s\"\n    datefmt: \"%Y-%m-%d %H:%M:%S\"\n\nhandlers:\n  console:\n    class: logging.StreamHandler\n    level: INFO\n    formatter: standard\n    stream: ext://sys.stdout\n  \n  file:\n    class: logging.handlers.RotatingFileHandler\n    level: INFO\n    formatter: json\n    filename: logs/app.log\n    maxBytes: 10485760\n    backupCount: 5\n    encoding: utf8\n\nloggers:\n  imagefetcher:\n    level: INFO\n    handlers: [console, file]\n    propagate: false\n\nroot:\n  level: INFO\n  handlers: [console, file]\nEOF)",
      "Bash(src/utils/config.py << 'EOF'\n\"\"\"Configuration management using Pydantic and environment variables.\"\"\"\n\nimport os\nfrom pathlib import Path\nfrom typing import Dict, List, Optional\n\nimport yaml\nfrom pydantic import Field\nfrom pydantic_settings import BaseSettings, SettingsConfigDict\n\n\nclass AppConfig\\(BaseSettings\\):\n    \"\"\"Application configuration from environment variables.\"\"\"\n\n    # Replit API\n    replit_api_url: str = Field\\(..., alias=\"REPLIT_API_URL\"\\)\n    replit_api_key: str = Field\\(..., alias=\"REPLIT_API_KEY\"\\)\n\n    # Image Source APIs\n    unsplash_access_key: Optional[str] = Field\\(None, alias=\"UNSPLASH_ACCESS_KEY\"\\)\n    pexels_api_key: Optional[str] = Field\\(None, alias=\"PEXELS_API_KEY\"\\)\n    pixabay_api_key: Optional[str] = Field\\(None, alias=\"PIXABAY_API_KEY\"\\)\n\n    # Application Settings\n    log_level: str = Field\\(\"INFO\", alias=\"LOG_LEVEL\"\\)\n    environment: str = Field\\(\"production\", alias=\"ENVIRONMENT\"\\)\n\n    # Database\n    database_path: str = Field\\(\"./data/state.db\", alias=\"DATABASE_PATH\"\\)\n\n    # Scheduling\n    schedule_enabled: bool = Field\\(True, alias=\"SCHEDULE_ENABLED\"\\)\n    schedule_interval_hours: int = Field\\(6, alias=\"SCHEDULE_INTERVAL_HOURS\"\\)\n\n    model_config = SettingsConfigDict\\(\n        env_file=\".env\",\n        env_file_encoding=\"utf-8\",\n        case_sensitive=False,\n        extra=\"ignore\",\n    \\)\n\n\nclass Config:\n    \"\"\"Main configuration class combining env vars and YAML config.\"\"\"\n\n    def __init__\\(self, config_path: str = \"config/config.yaml\"\\):\n        \"\"\"Initialize configuration.\n\n        Args:\n            config_path: Path to YAML configuration file\n        \"\"\"\n        # Load environment-based settings\n        self.env = AppConfig\\(\\)\n\n        # Load YAML configuration\n        config_file = Path\\(config_path\\)\n        if config_file.exists\\(\\):\n            with open\\(config_file, \"r\", encoding=\"utf-8\"\\) as f:\n                self.yaml_config = yaml.safe_load\\(f\\)\n        else:\n            raise FileNotFoundError\\(f\"Config file not found: {config_path}\"\\)\n\n    @property\n    def app_name\\(self\\) -> str:\n        \"\"\"Get application name.\"\"\"\n        return self.yaml_config.get\\(\"app\", {}\\).get\\(\"name\", \"Image Fetcher Bot\"\\)\n\n    @property\n    def app_version\\(self\\) -> str:\n        \"\"\"Get application version.\"\"\"\n        return self.yaml_config.get\\(\"app\", {}\\).get\\(\"version\", \"1.0.0\"\\)\n\n    @property\n    def batch_size\\(self\\) -> int:\n        \"\"\"Get batch size for processing SKUs.\"\"\"\n        return self.yaml_config.get\\(\"app\", {}\\).get\\(\"batch_size\", 50\\)\n\n    @property\n    def scheduler_config\\(self\\) -> Dict:\n        \"\"\"Get scheduler configuration.\"\"\"\n        return self.yaml_config.get\\(\"scheduler\", {}\\)\n\n    @property\n    def image_search_config\\(self\\) -> Dict:\n        \"\"\"Get image search configuration.\"\"\"\n        return self.yaml_config.get\\(\"image_search\", {}\\)\n\n    @property\n    def keywords_config\\(self\\) -> Dict:\n        \"\"\"Get keywords extraction configuration.\"\"\"\n        return self.yaml_config.get\\(\"keywords\", {}\\)\n\n    @property\n    def rate_limits\\(self\\) -> Dict:\n        \"\"\"Get rate limits configuration.\"\"\"\n        return self.yaml_config.get\\(\"rate_limits\", {}\\)\n\n    @property\n    def retry_config\\(self\\) -> Dict:\n        \"\"\"Get retry configuration.\"\"\"\n        return self.yaml_config.get\\(\"retry\", {}\\)\n\n    @property\n    def state_config\\(self\\) -> Dict:\n        \"\"\"Get state management configuration.\"\"\"\n        return self.yaml_config.get\\(\"state\", {}\\)\n\n    @property\n    def logging_config\\(self\\) -> Dict:\n        \"\"\"Get logging configuration.\"\"\"\n        return self.yaml_config.get\\(\"logging\", {}\\)\n\n    @property\n    def source_priorities\\(self\\) -> Dict[str, int]:\n        \"\"\"Get image source priorities.\"\"\"\n        return self.image_search_config.get\\(\"sources\", {}\\)\n\n    @property\n    def minimum_relevance_score\\(self\\) -> float:\n        \"\"\"Get minimum relevance score threshold.\"\"\"\n        return self.image_search_config.get\\(\"minimum_relevance_score\", 0.6\\)\n\n    @property\n    def validation_config\\(self\\) -> Dict:\n        \"\"\"Get image validation configuration.\"\"\"\n        return self.image_search_config.get\\(\"validation\", {}\\)\n\n    @property\n    def allowed_formats\\(self\\) -> List[str]:\n        \"\"\"Get allowed image formats.\"\"\"\n        return self.validation_config.get\\(\"allowed_formats\", [\"JPEG\", \"PNG\", \"WebP\"]\\)\n\n    def get_api_key\\(self, source: str\\) -> Optional[str]:\n        \"\"\"Get API key for a specific source.\n\n        Args:\n            source: Image source name \\(unsplash, pexels, pixabay\\)\n\n        Returns:\n            API key or None if not configured\n        \"\"\"\n        source_mapping = {\n            \"unsplash\": self.env.unsplash_access_key,\n            \"pexels\": self.env.pexels_api_key,\n            \"pixabay\": self.env.pixabay_api_key,\n        }\n        return source_mapping.get\\(source.lower\\(\\)\\)\n\n    def is_source_enabled\\(self, source: str\\) -> bool:\n        \"\"\"Check if an image source is enabled.\n\n        Args:\n            source: Image source name\n\n        Returns:\n            True if source has API key configured\n        \"\"\"\n        return self.get_api_key\\(source\\) is not None\n\n\n# Global config instance\n_config: Optional[Config] = None\n\n\ndef get_config\\(config_path: str = \"config/config.yaml\"\\) -> Config:\n    \"\"\"Get or create global configuration instance.\n\n    Args:\n        config_path: Path to YAML configuration file\n\n    Returns:\n        Config instance\n    \"\"\"\n    global _config\n    if _config is None:\n        _config = Config\\(config_path\\)\n    return _config\n\n\ndef reload_config\\(config_path: str = \"config/config.yaml\"\\) -> Config:\n    \"\"\"Reload configuration.\n\n    Args:\n        config_path: Path to YAML configuration file\n\n    Returns:\n        New Config instance\n    \"\"\"\n    global _config\n    _config = Config\\(config_path\\)\n    return _config\nEOF)",
      "mcp__Desktop_Commander__write_file",
      "Bash(git config:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git remote add:*)",
      "Bash(git branch:*)",
      "Bash(git push:*)",
      "Bash(git pull:*)",
      "Bash(git checkout:*)",
      "Bash(WHOLESALEHUB_API.md << 'EOF'\n# WholesaleHub Replit API Integration\n\n## Overview\n\nThe Image Fetcher Bot integrates with the WholesaleHub Replit app at `https://warnergears.replit.app` to automatically upload product images by SKU.\n\n## Authentication\n\nThe API uses **session-based authentication** \\(not API keys\\). The bot:\n\n1. Logs in with admin credentials to get a `connect.sid` session cookie\n2. Uses this cookie for all subsequent image upload requests\n3. Automatically re-authenticates if the session expires\n\n## Configuration\n\nAdd these to your `.env` file:\n\n```env\nREPLIT_API_URL=https://warnergears.replit.app\nREPLIT_EMAIL=warnergears@gmail.com\nREPLIT_PASSWORD=Choti00shaf#\n```\n\n## API Endpoints Used\n\n### 1. Login \\(Authentication\\)\n```\nPOST https://warnergears.replit.app/api/auth/login\nContent-Type: application/json\n\n{\n  \"email\": \"warnergears@gmail.com\",\n  \"password\": \"Choti00shaf#\"\n}\n```\n\n**Response**: Session cookie `connect.sid` is set\n\n### 2. Upload Image by SKU\n```\nPOST https://warnergears.replit.app/api/admin/products/upload-image\nCookie: connect.sid=<session-cookie-value>\nContent-Type: multipart/form-data\n\nForm fields:\n  - image: \\(file\\) JPEG, PNG, GIF, or WebP \\(max 10MB\\)\n  - sku: \\(string\\) Product SKU \\(case-insensitive\\)\n```\n\n**Success Response**:\n```json\n{\n  \"success\": true,\n  \"message\": \"Image uploaded successfully\",\n  \"filename\": \"1424313000372912001.png\",\n  \"path\": \"/product-images/1424313000372912001.png\"\n}\n```\n\n**Error Responses**:\n- `400` - Missing SKU, no image file, or invalid file type\n- `404` - No product found with that SKU\n- `401/403` - Not authenticated or not admin/staff\n\n## How the Bot Works\n\n1. **Fetch SKUs** \\(Manual for now\\)\n   - Currently: You provide a list of SKUs to process\n   - Future: API endpoint to list products without images\n\n2. **Search for Images**\n   - Extracts keywords from SKU name\n   - Searches Unsplash, Pexels, Pixabay\n   - Scores images by relevance\n\n3. **Upload to WholesaleHub**\n   - Validates image \\(format, size, dimensions\\)\n   - Logs in if not authenticated\n   - Uploads via `/api/admin/products/upload-image`\n   - Passes SKU + image file\n\n4. **Track State**\n   - Successful uploads logged in SQLite\n   - Failed SKUs saved to `reports/needs_review_*.txt`\n   - No reprocessing of completed SKUs\n\n## Important Notes\n\n### Session Management\n- Session cookie expires after inactivity\n- Bot automatically re-authenticates on 401/403 errors\n- One retry attempt after re-authentication\n\n### SKU Matching\n- SKU matching is case-insensitive on server\n- Server logs all uploads to `bot-upload-log.txt`\n\n### Image Requirements\n- **Formats**: JPEG, PNG, GIF, WebP\n- **Max Size**: 10MB\n- **Bot Validation**: Min 800x600, aspect ratio 0.5-2.0\n\n### Upload Behavior\n- Uploaded images take precedence over Zoho-sourced images\n- `imageSource` field set to `'uploaded'` after success\n- Images saved as `public/product-images/<zohoItemId>.<ext>`\n\n## Getting SKU List\n\n**Current Approach**: Manual list\n- Create a text file with SKU codes \\(one per line\\)\n- Read and process via custom script\n\n**Future Enhancement**: API endpoint\n- Request: `GET /api/admin/products?hasImage=false&limit=50`\n- Response: List of products without images\n\n## Testing\n\nTest the integration:\n\n```bash\n# 1. Set up .env with credentials\ncp .env.example .env\n# Edit .env with actual credentials\n\n# 2. Test authentication\npython -c \"from src.api.replit_client import ReplitClient; \\\\\nclient = ReplitClient\\('https://warnergears.replit.app', 'warnergears@gmail.com', 'Choti00shaf#'\\); \\\\\nprint\\('Auth success' if client.authenticate\\(\\) else 'Auth failed'\\)\"\n\n# 3. Run bot in test mode \\(manual SKU list\\)\npython src/main.py --run-once\n```\n\n## Troubleshooting\n\n### \"Authentication failed - no session cookie\"\n- Check email/password in `.env`\n- Verify network connectivity to Replit app\n- Check if admin account is active\n\n### \"404 - No product found with that SKU\"\n- SKU doesn't exist in WholesaleHub database\n- Check SKU spelling/format\n- SKU added to `needs_review` report\n\n### \"401/403 - Not authenticated\"\n- Session expired - bot will auto re-authenticate\n- If persists, check admin permissions\n\n### \"400 - Invalid file type\"\n- Only JPEG, PNG, GIF, WebP supported\n- Check image validation passed before upload\n\n## Security Notes\n\n- ⚠️ **Credentials in .env**: Never commit `.env` to git\n- ✅ `.env` is in `.gitignore`\n- ✅ Use `.env.example` as template\n- ⚠️ Session cookies are temporary - not stored persistently\n- ✅ Bot creates new session on each run\n\n## Future Enhancements\n\n1. **Product Listing API**\n   - GET endpoint to fetch SKUs without images\n   - Pagination support for large catalogs\n\n2. **Batch Upload**\n   - Upload multiple images in single request\n   - Reduce API calls\n\n3. **Webhook Integration**\n   - Trigger bot when new products added\n   - Real-time image attachment\n\n4. **Image Source Preference**\n   - Let WholesaleHub specify preferred image sources\n   - Custom keyword hints per product category\nEOF)",
      "mcp__Desktop_Commander__create_directory",
      "mcp__Desktop_Commander__get_file_info",
      "Bash(copy \"E:\\\\wgOneDrive\\\\OneDrive\\\\Desktop\\\\missing-image-skus.txt\" \"C:\\\\Users\\\\Samva\\\\projects\\\\imagefetcher\\\\real_skus.txt\")",
      "Bash(start:*)",
      "Bash(python:*)",
      "Bash(pip install:*)",
      "Bash(set:*)"
    ]
  }
}
